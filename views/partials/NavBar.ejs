<nav class="navbar">
  <div class="nav-container">
    <!-- Logo o nombre del sistema -->
    <a href="/users/dashboard" class="logo">SONIX LTD</a>

    <div class="nav-links">
      <!-- Notificaciones de stock -->
      <a href="/alerts" class="notification" title="Alertas de Stock">
        <i class="fas fa-bell"></i>
        <% if (alerts.length > 0) { %>
          <span class="badge"><%= alerts.length %></span>
        <% } %>
      </a>

      <!-- Usuario actual -->
      <% if (currentUser) { %>
        <div class="user-info">
          <span class="status-dot"></span>
          <span class="username"><%= currentUser.name %></span>

          <!-- Menú de opciones -->
          <a href="/users/dashboard" title="Ir al Dashboard">
            <i class="fas fa-user-circle"></i>
          </a>
          <a href="/login/logout" title="Cerrar sesión">
            <i class="fas fa-sign-out-alt"></i>
          </a>
        </div>
      <% } %>
    </div>
  </div>
</nav>

<% if (alerts && alerts.length > 0) { %>
  <!-- 🔔 Notificación flotante de alerta de stock -->
  <div id="stock-toast" class="stock-toast">
    🔔 ¡Tienes <strong><%= alerts.length %></strong> alerta<%= alerts.length > 1 ? 's' : '' %> de stock bajo!
    <a href="/alerts" class="ver-alertas">Ver alertas</a>
  </div>

  <!-- 🔊 Sonido de alerta (solo si no ha sonado antes en la sesión) -->
  <script>
    // Verificamos si ya se reprodujo la alerta en esta sesión
    if (!sessionStorage.getItem('alertSoundPlayed')) {
      const audio = new Audio('/sounds/alert.mp3');
      audio.play().catch(() => {}); // Evita errores si el navegador bloquea
      sessionStorage.setItem('alertSoundPlayed', 'true');
    }

    // Ocultar automáticamente el toast después de 5 segundos
    setTimeout(() => {
      const toast = document.getElementById('stock-toast');
      if (toast) toast.remove();
    }, 5000);
  </script>
<% } %>